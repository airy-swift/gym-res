# 体育館予約共有システム 仕様書（Next.js + Firebase + Gemini構成）

## 1. 概要
少人数〜中規模グループで体育館の予約（抽選応募）を行う際、
予約の重複・漏れを防ぐための予約情報共有システム。
カレンダー上で予約状況を可視化し、クリックで公式予約ページへ遷移可能とする。

## 2. 仕様 *レスポンシブ対応必須

### 2.1 カレンダー表示
- 月表示形式。
- 各日付マスの背景色：
  - 白：予約なし
  - オレンジ：1件以上の予約あり
- 日付をクリックすると当日の3枠（午前／午後／夜）を一覧表示。
- 各枠には予約者名（複数可）を表示。
- 枠クリックで公式予約システムへのURLを生成して遷移。

### 2.2 予約枠仕様
- 各日3枠固定（午前／午後／夜）。
- 同一枠への複数人登録を許容（抽選応募前提）。
- 各枠には応募者全員の名前を一覧表示。

### 2.3 スクリーンショット取り込み
- クライアント側でスクショをGeminiに送信して解析。
- 出力結果（予約日・枠・名前）を確認画面で修正可能。
- 確定後にFirebase(Firestore)へ登録。
- 画像はStorageに保存せず、送信後即破棄。

### 2.4 Firestoreデータ構造（日付単位）
コレクション名：`reservations`

```json
{
  "date": "2025-11-20",
  "gymName": "北区体育館",
  "slots": {
    "morning": ["山田"],
    "afternoon": [],
    "night": ["佐藤"]
  },
  "confirmed": true,
  "lastUpdatedBy": "user123",
  "updatedAt": "2025-11-10T13:00:00Z"
}
```

### 2.5 確認・修正フロー
1. ユーザーが予約画面スクショをアップロード。
2. Geminiで解析（クライアント内処理）。
3. 結果を人間が確認・編集。
4. Firestoreに確定データを登録（`confirmed: true`）。

### 2.6 セキュリティ・権限
- Firebase Authenticationで編集権限を制御。
- 閲覧は全メンバー可能。
- 編集・登録は認可ユーザーのみ。

### 2.7 Firestore運用補助
- `confirmed` フラグでAI自動結果と確定済みを区別。
- `lastUpdatedBy` と `updatedAt` で編集履歴を簡易的に追跡。

### 2.8 技術構成
- Next.js（App Router）
- Firebase（Auth / Firestore）
- Gemini API（クライアント直呼び）

---

## 3. 主な画面
1. **カレンダー画面**
   - 月表示・色分け・クリックで詳細モーダル。
2. **日付詳細モーダル**
   - 各枠ごとの予約者リスト＋公式サイトリンク。
3. **スクショアップロード＆確認画面**
   - Gemini解析結果確認・修正・登録。

---

## 4. 運用メモ
- Gemini出力の信頼性を確保するため、必ず人の目による確認を挟む。
- スクショデータは保存しない。
- Firestoreデータは常に日付単位で上書き更新。
- 公式予約サイトのURL生成は日付＋枠情報をパラメータ付与。
